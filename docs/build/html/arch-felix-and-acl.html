<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Calico Component Architecture &mdash; Project Calico 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Project Calico 0.0.1 documentation" href="index.html" />
    <link rel="next" title="Configuring Calico" href="configuration.html" />
    <link rel="prev" title="Calico Architecture Overview" href="arch-overview.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="configuration.html" title="Configuring Calico"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="arch-overview.html" title="Calico Architecture Overview"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Project Calico 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="calico-component-architecture">
<h1>Calico Component Architecture<a class="headerlink" href="#calico-component-architecture" title="Permalink to this headline">¶</a></h1>
<div class="section" id="felix-the-calico-plugin-and-the-calico-acl-manager">
<h2>Felix, the Calico Plugin and the Calico ACL Manager<a class="headerlink" href="#felix-the-calico-plugin-and-the-calico-acl-manager" title="Permalink to this headline">¶</a></h2>
<p>The current high level architecture of Calico is described in
<a class="reference internal" href="arch-overview.html"><em>Calico Architecture Overview</em></a>.</p>
<p>This document describes a planned new architecture that clearly
separates Calico’s core function from how that function is integrated
into the environment that Calico is running – for example, OpenStack,
CoreOS or some other cloud OS; or a switch OS such as Cumulus Linux. The
components of the new architecture, and the interactions between them,
are shown in the following diagram.</p>
<div class="figure">
<img alt="" src="_images/calico_API_arch_Sept_2014.png" />
</div>
<p>Each segment is broken down below.</p>
<div class="section" id="felix">
<h3>Felix<a class="headerlink" href="#felix" title="Permalink to this headline">¶</a></h3>
<p>Felix (a.k.a. The Calico Agent) is the daemon responsible for
programming the Linux host machines. This daemon has a number of
responsibilities. It is responsible for programming ACLs and routes into
the Linux kernel. It may also be required to perform VM discovery (if it
is not expecting to be notified of VM creation). It exchanges
information with the Cloud Orchestration Provider via the Calico
Plug-In, and with the Calico ACL Manager. The information it exchanges
northwards is defined by the Calico API, which is conceptually split
into several parts (see below). Felix is in effect the portion of Calico
that does the actual heavy lifting, turning an abstract networking model
into configuration on compute hosts that creates the real network
topology.</p>
<p>On some platforms, Felix may be responsible for doing groundwork for
other processes. For example, in OpenStack Felix is responsible for
programming NAT rules for use by the OpenStack Metadata Agent.</p>
<p>Felix is responsible for ensuring that the centrally-determined routing
policy is put in place on all machines that require it, and that the
system is stable and secure. It is not expected that instances of Felix
will communicate amongst themselves in a peer-to-peer fashion: such
logic should not be required.</p>
</div>
<div class="section" id="cloud-orchestration-provider">
<h3>Cloud Orchestration Provider<a class="headerlink" href="#cloud-orchestration-provider" title="Permalink to this headline">¶</a></h3>
<p>The cloud orchestration provider represents the logic of whatever cloud
system Calico is running in. This function is responsible for arranging
compute resource and for managing lots of knowledge in a
platform-specific manner. The expectation is that Project Calico will
need to make few or no changes to the upstream orchestration provider.</p>
<div class="section" id="calico-plug-in">
<h4>Calico Plug-In<a class="headerlink" href="#calico-plug-in" title="Permalink to this headline">¶</a></h4>
<p>The Calico Plug-in is the component responsible for providing
translation between the Cloud Orchestration Provider and the Calico
Endpoint and Network APIs. This layer will also handle all communication
between Felix and the orchestration provider.</p>
<p>The Calico Plug-In is responsible for providing all information required
by the Calico Endpoint API. This can actually happen in a bi-directional
manner. Depending on the situation, Felix may request information from
the Calico Plug-In about endpoints on its own (e.g. by discovering tap
interfaces, as in the OpenStack case) or it may be instructed to take
ownership of interfaces by the Calico Plug-In. Exactly which flow is
used depends on the Cloud Orchestration Provider being used.</p>
</div>
</div>
<div class="section" id="calico-acl-manager">
<h3>Calico ACL Manager<a class="headerlink" href="#calico-acl-manager" title="Permalink to this headline">¶</a></h3>
<p>Calico’s concept of ACLs is more complex than the apparently
corresponding concept in some cloud OSs, e.g. Security Group
configuration in OpenStack, because it also incorporates other concepts
that cloud OSs may treat separately. For example – to continue the
OpenStack case – Calico’s ACLs incorporate the implications of
OpenStack’s tenant, network and router configurations as well as of its
security groups. Therefore the distillation of cloud OS config into ACLs
for each endpoint is a complex task, and one which we believe is worth
centralizing, rather than requiring every Felix instance to do the same.
Hence the Calico ACL Manager component.</p>
<p>The Calico ACL manager will communicate with Felixes using the Calico
ACL API. In particular, it will publish updates to the ACL status of
individual machines to subscribers, as well as be able to provide
&#8216;current state&#8217; ACL information.</p>
</div>
<div class="section" id="calico-api">
<h3>Calico API<a class="headerlink" href="#calico-api" title="Permalink to this headline">¶</a></h3>
<p>The Calico API is conceptually divided into three parts:</p>
<ul class="simple">
<li>The Calico Endpoint API - this communicates data <em>about</em> endpoints
(such as IP addresses, MAC address, and so on)</li>
<li>The Calico ACL API - this communicates the state of ACLs for a given
endpoint</li>
<li>The Calico Network API - this communicates topology information to
the ACL manager</li>
</ul>
<p>More detail on the API is provided in <a class="reference internal" href="api-proposal.html"><em>Calico API Design</em></a>.</p>
</div>
<div class="section" id="bgp-stack-not-present-on-diagram">
<h3>BGP Stack (not present on diagram)<a class="headerlink" href="#bgp-stack-not-present-on-diagram" title="Permalink to this headline">¶</a></h3>
<p>The BGP stack is not present on the diagram, but is nevertheless part of
the overall Calico architecture (as shown in <a class="reference internal" href="arch-overview.html"><em>Calico Architecture Overview</em></a>.</p>
<p>Felix does not talk to the BGP stack directly, but instead the BGP stack
is programmed via the Linux kernel. In effect, the programming of the
BGP stack happens as a result of Felix adding static routes to the
kernel, not in response to any &#8216;BGP programming&#8217; action taken by Felix.
This means that there is effectively no direct interface between the BGP
stack and any other part of Calico.</p>
</div>
</div>
<div class="section" id="example-flow">
<h2>Example Flow<a class="headerlink" href="#example-flow" title="Permalink to this headline">¶</a></h2>
<p>The following is an example flow of information through this
architecture. This is an example of Endpoint provisioning in an IPv4
network.</p>
<ol class="arabic simple">
<li>Felix spots the creation of a likely endpoint interface, for example
by noticing the appearance of a new TAP interface (Endpoint
discovery). It makes a request over the Calico Endpoint API to the
Calico Plug-In asking for data about the Endpoint to which the
interface belongs.</li>
<li>The Calico Plug-In receives the request. It uses whatever plug-in
interface is defined by the Cloud Orchestration Provider to determine
information about that Endpoint. In this instance the most important
information is the IP address of the machine behind the interface and
some unique identifier for the Endpoint.</li>
<li>Felix receives the response over the Calico Endpoint API. It programs
the static route for that Endpoint into the FIB. It also enables
proxy ARP on the Endpoint interface and sets up any necessary NAT
rules for metadata acquisition.</li>
<li>Felix then queries the Calico ACL API for ACL rules.</li>
<li>It receives the ACL rules.</li>
<li>Felix programs those ACL rules into the kernel.</li>
<li>Felix signals to the Calico Plug-In that the Endpoint is successfully
provisioned (if necessary).</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Calico Component Architecture</a><ul>
<li><a class="reference internal" href="#felix-the-calico-plugin-and-the-calico-acl-manager">Felix, the Calico Plugin and the Calico ACL Manager</a><ul>
<li><a class="reference internal" href="#felix">Felix</a></li>
<li><a class="reference internal" href="#cloud-orchestration-provider">Cloud Orchestration Provider</a><ul>
<li><a class="reference internal" href="#calico-plug-in">Calico Plug-In</a></li>
</ul>
</li>
<li><a class="reference internal" href="#calico-acl-manager">Calico ACL Manager</a></li>
<li><a class="reference internal" href="#calico-api">Calico API</a></li>
<li><a class="reference internal" href="#bgp-stack-not-present-on-diagram">BGP Stack (not present on diagram)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-flow">Example Flow</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="arch-overview.html"
                        title="previous chapter">Calico Architecture Overview</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="configuration.html"
                        title="next chapter">Configuring Calico</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/arch-felix-and-acl.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="configuration.html" title="Configuring Calico"
             >next</a> |</li>
        <li class="right" >
          <a href="arch-overview.html" title="Calico Architecture Overview"
             >previous</a> |</li>
        <li><a href="index.html">Project Calico 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Metaswitch Networks.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>