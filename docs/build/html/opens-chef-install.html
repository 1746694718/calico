<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Chef Trial Install &mdash; Project Calico 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Project Calico 0.0.1 documentation" href="index.html" />
    <link rel="up" title="Calico with OpenStack" href="openstack.html" />
    <link rel="next" title="Major Differences from Standard OpenStack" href="opens-external-conn.html" />
    <link rel="prev" title="Installation Instructions" href="opens-install-inst.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="opens-external-conn.html" title="Major Differences from Standard OpenStack"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="opens-install-inst.html" title="Installation Instructions"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Project Calico 0.0.1 documentation</a> &raquo;</li>
          <li><a href="openstack.html" accesskey="U">Calico with OpenStack</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="chef-trial-install">
<h1>Chef Trial Install<a class="headerlink" href="#chef-trial-install" title="Permalink to this headline">¶</a></h1>
<p>If you&#8217;re interested in trying out Calico but you don&#8217;t have much
familiarity with installing OpenStack, you can install an
OpenStack-with-Calico deployment using Chef. If you&#8217;re familiar with
Chef, this is the fastest way to get a quick test environment for
playing around with Project Calico.</p>
<p>This install procedure has only been tested on Ubuntu 14.04. Other
versions of Ubuntu may also work successfully. It is unlikely that this
install will work with Red Hat Enterprise Linux or its variants.</p>
<p>This procedure requires a Chef server: it is not sufficient to use
chef-solo. The installation uses knowledge about the other nodes in the
deployment to determine how to configure a node.</p>
<div class="section" id="what-you-get">
<h2>What You Get<a class="headerlink" href="#what-you-get" title="Permalink to this headline">¶</a></h2>
<p>This install guide creates a deployment that contains a single control
node and at least two compute nodes. All the compute nodes are connected
in a BGP mesh, no BGP route reflector is required. This is the simplest
possible configuration for Calico.</p>
<p>Note that this is <strong>not</strong> a production install of Project Calico or of
OpenStack. It is intended for trial and testing purposes only.</p>
</div>
<div class="section" id="how-to-use-it-for-chef-newbies">
<h2>How To Use It: For Chef Newbies<a class="headerlink" href="#how-to-use-it-for-chef-newbies" title="Permalink to this headline">¶</a></h2>
<p>If you are unfamiliar with Chef you may want to use the hosted Chef as a
service, as mentioned on the <a class="reference external" href="http://gettingstartedwithchef.com/">Getting Started with Chef
website</a>. The following
instructions provide a step-by-step guide on installing Chef and using
the hosted Chef service to install a test OpenStack+Calico environment.</p>
<div class="section" id="ingredients">
<h3>Ingredients<a class="headerlink" href="#ingredients" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>At least four servers running Ubuntu 14.04. These are for:<ul>
<li>One OpenStack control node</li>
<li>Two OpenStack compute nodes.</li>
<li>One Chef bootstrap server for running the node bootstrapping.</li>
</ul>
</li>
</ul>
<p>You can in principle get away with using only three machines and
performing the bootstrapping from one of the OpenStack nodes, however
this has never been tested. If you try this out, please let us know how
it went!</p>
</div>
<div class="section" id="prepare-your-openstack-nodes">
<h3>Prepare Your OpenStack Nodes<a class="headerlink" href="#prepare-your-openstack-nodes" title="Permalink to this headline">¶</a></h3>
<p>The default Ubuntu 14.04 installation may have hosts configuration that
causes problems for the Chef installation. We recommend ensuring the
following preparation is performed on each OpenStack node prior to
starting the bootstrap process: - Ensure your hostname is correctly set.
Edit the /etc/hostname file and set the correct name for each node
(names must be unique). - Ensure your loopback IP and OpenStack DNS
entries are configured. Edit the /etc/hosts file: - Set the loopback IP
address to 127.0.0.1. - Set your hostname IP address to your static IP.
- Configure the hostnames / IPs of the other OpenStack nodes.</p>
<p>If you are using VMWare and VMs for each of these machines (for
testing), ensure the VM setting allows the VM to expose hardware
assisted virtualization to the guest OS (setting under the CPU
configuration).</p>
</div>
<div class="section" id="prepare-chef">
<h3>Prepare Chef<a class="headerlink" href="#prepare-chef" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">If you are intending to use the hosted Chef service, follow the
instructions on <a class="reference external" href="http://gettingstartedwithchef.com/">Getting Started with
Chef</a> to create a new user and
to create an organization for that user.</p>
</li>
<li><p class="first">On your Chef bootstrap server, follow the instructions on <a class="reference external" href="http://gettingstartedwithchef.com/">Getting
Started with Chef</a> to install
Chef.</p>
</li>
<li><p class="first">Clone the calico-chef repo on the Chef bootstrap server (or somewhere
sensible):</p>
<div class="highlight-python"><div class="highlight"><pre>git clone https://github.com/Metaswitch/calico-chef.git
</pre></div>
</div>
</li>
<li><p class="first">Create a directory for the chef installation configuration. The
following instructions assume you created a <tt class="docutils literal"><span class="pre">.chef</span></tt> directory under
the <tt class="docutils literal"><span class="pre">calico-chef</span></tt> directory that was created by the git clone.</p>
</li>
<li><p class="first">Generate the knife config for the organization on the hosted chef
site, download the <tt class="docutils literal"><span class="pre">knife.rb</span></tt> into the <tt class="docutils literal"><span class="pre">.chef</span></tt> directory.</p>
</li>
<li><p class="first">Download both the organization and user keys from the website into
the <tt class="docutils literal"><span class="pre">.chef</span></tt> directory.</p>
</li>
<li><p class="first">Load the roles from file. From the <tt class="docutils literal"><span class="pre">.chef</span></tt> directory:</p>
<div class="highlight-python"><div class="highlight"><pre>knife role from file ../roles/*.rb
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="bootstrap-your-openstack-nodes">
<h3>Bootstrap your OpenStack nodes<a class="headerlink" href="#bootstrap-your-openstack-nodes" title="Permalink to this headline">¶</a></h3>
<p>Setting up your test deployment nodes is a two-stage process. The first
is to bootstrap each node with the appropriate role. Once all roles are
assigned to the nodes, the chef client is re-run to update the
configuration on each node. This is necessary to set up the BGP mesh,
which needs to have knowledge of each compute node in the deployment.</p>
<p>To install the controller node, from the chef bootstrap server run:</p>
<div class="highlight-python"><div class="highlight"><pre>knife bootstrap --sudo --verbose --run-list &quot;role[controller]&quot; --ssh-user &lt;username&gt; --ssh-password &lt;password&gt; &lt;controller node hostname&gt;
</pre></div>
</div>
<p>To install each compute node, from the chef bootstrap server run the
following for each compute node:</p>
<div class="highlight-python"><div class="highlight"><pre>knife bootstrap --sudo --verbose --run-list &quot;role[compute]&quot; --ssh-user &lt;username&gt; --ssh-password &lt;password&gt; &lt;compute node hostname&gt;
</pre></div>
</div>
<p>Check that all nodes appear in the host Chef Web UI.</p>
<p>Now, log on to each node in the OpenStack deployment (controller and
compute nodes) and run:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">chef</span><span class="o">-</span><span class="n">client</span>
</pre></div>
</div>
<p>This will fix up the BGP mesh between the compute nodes.</p>
<p>You should now be ready to go!</p>
</div>
</div>
<div class="section" id="how-to-use-it-for-experienced-chef-users">
<h2>How To Use It: For Experienced Chef Users<a class="headerlink" href="#how-to-use-it-for-experienced-chef-users" title="Permalink to this headline">¶</a></h2>
<p>We provide a single <tt class="docutils literal"><span class="pre">calico</span></tt> cookbook in <a class="reference external" href="https://github.com/Metaswitch/calico-chef">this
repository</a>. This cookbook
can be cloned in git and then added to the Chef server in the usual way.</p>
<p>The cookbook defines two roles: <tt class="docutils literal"><span class="pre">controller</span></tt> and <tt class="docutils literal"><span class="pre">compute</span></tt>. To set
up your deployment, perform the following steps:</p>
<ol class="arabic simple">
<li>Bootstrap one machine with the <tt class="docutils literal"><span class="pre">controller</span></tt> role. This will install
OpenStack&#8217;s control components on to that machine. When using
OpenStack you will mostly interact with the UI on that machine.</li>
<li>Bootstrap at least two further machines with the <tt class="docutils literal"><span class="pre">compute</span></tt> role.</li>
</ol>
<p>Note that this procedure works best when you assign all your compute
machines the <tt class="docutils literal"><span class="pre">compute</span></tt> role <em>before</em> executing their run lists. This
way you&#8217;ll only need to execute the run list for each compute machine
once.</p>
<p>If you execute the run list for a compute machine before all the compute
machines have been assigned their role, you&#8217;ll need to re-run the
run-list once all compute machines are present. The <tt class="docutils literal"><span class="pre">compute</span></tt> role
builds up config that relies on knowing all the other <tt class="docutils literal"><span class="pre">compute</span></tt> nodes.</p>
<ol class="arabic simple" start="3">
<li>Play with Calico!</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Chef Trial Install</a><ul>
<li><a class="reference internal" href="#what-you-get">What You Get</a></li>
<li><a class="reference internal" href="#how-to-use-it-for-chef-newbies">How To Use It: For Chef Newbies</a><ul>
<li><a class="reference internal" href="#ingredients">Ingredients</a></li>
<li><a class="reference internal" href="#prepare-your-openstack-nodes">Prepare Your OpenStack Nodes</a></li>
<li><a class="reference internal" href="#prepare-chef">Prepare Chef</a></li>
<li><a class="reference internal" href="#bootstrap-your-openstack-nodes">Bootstrap your OpenStack nodes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use-it-for-experienced-chef-users">How To Use It: For Experienced Chef Users</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="opens-install-inst.html"
                        title="previous chapter">Installation Instructions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="opens-external-conn.html"
                        title="next chapter">Major Differences from Standard OpenStack</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/opens-chef-install.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="opens-external-conn.html" title="Major Differences from Standard OpenStack"
             >next</a> |</li>
        <li class="right" >
          <a href="opens-install-inst.html" title="Installation Instructions"
             >previous</a> |</li>
        <li><a href="index.html">Project Calico 0.0.1 documentation</a> &raquo;</li>
          <li><a href="openstack.html" >Calico with OpenStack</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Metaswitch Networks.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>